### instructions

write analysis in the @analysis section of this doc

### task

Each command execution is extremely slow, likely due to the agentic nature of the tools.
To mitigate this, I want to add a concept of 'command queues', where user can keep issuing commands,
the additional commands will be queued. and processed.

Before a command is processed, user can cancel the command, but if the command is being processed, it cannot be cancelled.

Additional feature:
- Each command should create a snapshot in .history
- only 20 recent snapshots are kept
- user can jump back to previous snapshots

### analysis

**Root Cause:**
The slow command execution is primarily due to:
1. CLI process spawning overhead for each command
2. No ability to queue commands - blocking UI during execution
3. Each command requires full AI model initialization

**Current Implementation Issues:**
- Synchronous command execution blocks the UI
- No progress feedback during long operations
- No way to undo/redo changes
- Each command spawns a new process with initialization overhead

### fix_plan

**Phase 1: Switch to Claude Code SDK (High Priority)**
- Replace CLI spawning with TypeScript SDK (@anthropic-ai/claude-code)
- Benefits: 30-50% performance improvement, native cancellation, streaming progress
- Implementation: Update server.js to use SDK query() function
- Add real-time progress updates via WebSocket or SSE

**Phase 2: Command Queue System**
- Implement queue data structure with status tracking (pending/executing/completed/cancelled)
- Add UI panel showing queue status with ability to cancel pending commands
- Process commands sequentially with visual feedback
- Prevent cancellation of currently executing commands

**Phase 3: Snapshot History System**
- Create `.history/` directory for storing snapshots
- Save file state before each command execution
- Implement timestamp-based snapshot naming (e.g., `.history/2025-09-02_01-24-05_edit.html`)
- Add UI controls for history navigation (previous/next buttons)
- Auto-cleanup to maintain only 20 most recent snapshots

**Phase 4: Additional Optimizations**
- Command batching: Combine multiple related edits into single AI calls
- Smart caching: Cache common operations and patterns
- Progressive updates: Stream and apply changes incrementally
- Parallel execution: Process non-conflicting commands simultaneously

**Technical Architecture:**
```
Frontend (editor.js):
- Queue management UI component
- History navigation controls
- Progress indicators
- WebSocket/SSE client for real-time updates

Backend (server.js):
- Claude Code SDK integration
- Command queue processor
- Snapshot manager
- WebSocket/SSE server for progress streaming

Storage:
- .history/
  - 2025-09-02_01-24-05_001_edit.html
  - 2025-09-02_01-24-05_002_component.html
  - metadata.json (tracking snapshots)
```

**Expected Improvements:**
- 30-50% faster execution with SDK
- Non-blocking UI with queue system
- Easy rollback with snapshot history
- Better user experience with progress feedback

### related_files

- `/tools/html_live_editor/server.js` - Main backend file to update with SDK
- `/tools/html_live_editor/editor.js` - Frontend to add queue UI and history controls
- `/tools/html_live_editor/index.html` - HTML structure for new UI components
- `/tools/html_live_editor/style.css` - Styling for queue and history UI
- `/tools/html_live_editor/docs/claude-code-sdk-typescript.md` - SDK documentation
- `/tools/html_live_editor/package.json` - Add SDK dependency